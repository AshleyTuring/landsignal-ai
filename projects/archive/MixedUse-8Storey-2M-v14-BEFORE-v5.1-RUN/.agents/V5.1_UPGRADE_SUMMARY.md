# v5.1 Upgrade Summary

## Two Critical Fixes Applied

### 1. **Codex Verbosity Fix** ✅ 
**Problem:** Codex outputs "thinking" and "exec" traces (all internal reasoning)  
**Solution:** Redirect stderr to `/dev/null` for Codex calls  
**Example:**
```bash
# Before:
codex exec ... > output.md 2>&1

# After:
codex exec ... > output.md 2>/dev/null
```

### 2. **Prompts Refactored to Variables** ✅
**Problem:** Hardcoded prompts repeated across 4 scripts (maintenance nightmare)  
**Solution:** Created `PROMPTS_CONFIG.sh` with shared variables  
**Benefits:**
- Single source of truth for all prompts
- Easy to update/test prompts
- Consistent across all phases
- Better maintainability

## Files Updated

### ✅ Fully Updated:
1. `PROMPTS_CONFIG.sh` - Created (shared prompt variables)
2. `orchestrate_independent.sh` - All prompts use variables + Codex stderr suppressed
3. `CLAUDE_CLI_FIX.md` - Documented Claude CLI `--system-prompt` solution

### ⏳ Partially Updated (need completion):
4. `orchestrate_crossvalidation.sh` - Gemini + Codex done, need Grok + Claude + disagreement
5. `orchestrate_technical_iteration.sh` - Need to add source + update all prompts + Codex stderr
6. `orchestrate_synthesis.sh` - Need to add source + update Claude synthesis prompt

## Remaining Work

For each of the 3 partially updated scripts:
1. Add at top (after `set -e`):
   ```bash
   # Source shared prompts
   SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
   source "$SCRIPT_DIR/PROMPTS_CONFIG.sh"
   ```
2. Replace all hardcoded prompts with variables:
   - Gemini: Use `$PROMPT_CRITIQUE` or `$PROMPT_ITERATION` or `$PROMPT_SYNTHESIS`
   - Codex: Use variables + add `2>/dev/null`
   - Grok: Use variables
   - Claude: Use `--system-prompt "$SYSTEM_PROMPT" -p "$PROMPT_XXX"`
3. Update version comment from `v5.0` to `v5.1`

## Testing Plan

1. Test `orchestrate_independent.sh` with all 4 LLMs
2. Verify Codex output has NO thinking/exec traces
3. Verify Claude output is 150+ lines with SearchLand filter prompts
4. Complete remaining script updates
5. Run full v14 system end-to-end

## Variable Reference

From `PROMPTS_CONFIG.sh`:
- `$SYSTEM_PROMPT` - For Claude `--system-prompt` flag
- `$PROMPT_GENERATION` - Phase 0: Independent generation
- `$PROMPT_CRITIQUE` - Phase 1: Cross-validation critique
- `$PROMPT_DISAGREEMENT` - Phase 1: Disagreement analysis
- `$PROMPT_ITERATION` - Phase 1.5: Technical iteration
- `$PROMPT_SYNTHESIS` - Phase 2: Final synthesis

